import{c as $}from"./index-BsZg814E.js";import{f as T,a4 as E,r as g,ah as S,o as x,s as C,D as o,j as D,x as t,z as c,O as d}from"./libs-BXdPB6rs.js";import{w as I,b as V,h as L,aq as j,F as q,ar as A,L as M,B as N,t as H,S as O,v as R}from"./arcoDesign-BlYsxJJr.js";import{I as z}from"./index-DkLgg9UI.js";const W=T({__name:"index",setup(U){const k=$(),{t:v}=E(),l=g(!1),a=g({rememberPassword:!0,token:k.authToken}),s=g(),w=async({errors:e,values:r})=>{var n,m,u;const i=e?Object.keys(e):[];if(i.length>0){(n=s.value)==null||n.scrollToField(i[0]);return}const{token:f,rememberPassword:_}=r;if(!l.value){l.value=!0,(m=s.value)==null||m.setFields({token:{status:"validating",message:""}});try{await k.setAuthToken(f,_),V.success(v("login.form.login.success"))}catch(p){(u=s.value)==null||u.setFields({token:{status:"error",message:`${v("login.form.login.failed")}  ${p.message}`}})}finally{l.value=!1}}},{query:h}=S();return x(()=>{var e;h.token&&(a.value.token=h.token,(e=s.value)==null||e.$emit("submit",{values:a.value,errors:void 0},new Event("submit")))}),(e,r)=>{const i=L,f=z,_=j,n=q,m=A,u=M,p=N,b=H,y=O,P=R,B=I;return D(),C(B,{justify:"center"},{default:o(()=>[t(P,{xs:24,sm:20,md:16,lg:12,xl:8},{default:o(()=>[t(y,{direction:"vertical",fill:""},{default:o(()=>[t(i,{heading:3},{default:o(()=>[c(d(e.$t("login.form.title")),1)]),_:1}),t(b,{ref_key:"loginForm",ref:s,model:a.value,class:"login-form",layout:"vertical",onSubmit:w},{default:o(()=>[t(n,{field:"token",rules:[{required:!0,message:e.$t("login.form.password.errMsg")}],"validate-trigger":["change","input"],"hide-label":""},{default:o(()=>[t(_,{modelValue:a.value.token,"onUpdate:modelValue":r[0]||(r[0]=F=>a.value.token=F),placeholder:e.$t("login.form.password.placeholder"),"allow-clear":""},{prefix:o(()=>[t(f)]),_:1},8,["modelValue","placeholder"])]),_:1},8,["rules"]),t(n,{field:"rememberPassword",class:"login-form-password-actions"},{default:o(()=>[t(m,{checked:"rememberPassword","model-value":a.value.rememberPassword},{default:o(()=>[c(d(e.$t("login.form.rememberPassword")),1)]),_:1},8,["model-value"]),t(u,{style:{marginLeft:"auto"},href:"https://github.com/PBH-BTN/PeerBanHelper/wiki/%E5%A6%82%E4%BD%95%E9%87%8D%E7%BD%AEToken"},{default:o(()=>[c(d(e.$t("login.form.forgetPassword")),1)]),_:1})]),_:1}),t(p,{type:"primary","html-type":"submit",long:"",loading:l.value},{default:o(()=>[c(d(e.$t("login.form.login")),1)]),_:1},8,["loading"])]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})}}});export{W as default};
