import{u as M,g as q,a as G,_ as W}from"./index-BgmMgWxB.js";import{u as X,i as H,a as J,b as K,c as Q,d as Y,e as Z,f as ee,E as C}from"./echarts-DS45MtmJ.js";import{f as ae,a4 as te,a as T,c as oe,r as I,w as A,a5 as B,s as E,t as e,j as P,y as t,a2 as a,v as f,x as g,u as le}from"./libs-NGCarF3M.js";import{aj as p,w as se,L as ne,R as re,r as de,F as ie,ak as pe,t as ue,a3 as me,C as ce,v as fe,al as ge,am as he,U as _e,T as ye,S as ve}from"./arcoDesign-DtXL3Up2.js";const be=ae({__name:"index",setup(xe){const{t:l}=te();X([H,J,K,Q,Y,Z,ee]);const _=M(),r=T({field:"peerId",enableThreshold:!0,mergeSameVersion:!1}),v=oe(()=>({text:l("page.charts.loading"),color:_.isDark?"rgb(60, 126, 255)":"rgb(22, 93, 255)",textColor:_.isDark?"rgba(255, 255, 255, 0.9)":"rgb(29, 33, 41)",maskColor:_.isDark?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"})),h=I({tooltip:{trigger:"item",appendToBody:!0,formatter:'<p style="word-wrap:break-all"><b>{b}</b></p>  {c} ({d}%)'},legend:{orient:"vertical",left:"right",type:"scroll",right:10,top:20,bottom:20,data:[],textStyle:{overflow:"truncate",width:100},tooltip:{show:!0}},backgroundColor:_.isDark?"rgba(0, 0, 0, 0.0)":void 0,series:[{name:l("page.charts.options.field."+r.field),type:"pie",radius:"55%",center:["50%","60%"],data:[],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),R=n=>{n==="day"?d.range=[p().startOf("day").add(-7,"day").toDate(),new Date]:d.range=[p().startOf("hour").add(-6,"hour").toDate(),new Date]};A(r,n=>{$(n.field,n.enableThreshold)});const{loading:U,run:$}=B(G,{defaultParams:["peerId",!0],onSuccess:n=>{if(n.data){const s=n.data.map(o=>(o.data===""&&(o.data=l("page.charts.options.field.empty")),o));if(r.mergeSameVersion&&r.field==="peerId"){const o=new Map;s.forEach(i=>{let c=i.data;const u=c.match(/^([-]?[a-zA-z]+)[0-9]+.*/);u&&(u==null?void 0:u.length)>=2&&(c=u[1]+"*"),o.has(c)?o.set(c,o.get(c)+i.count):o.set(c,i.count)}),h.value.legend.data=[],h.value.series[0].data=[],Array.from(o).forEach(([i,c])=>{h.value.legend.data.push(i),h.value.series[0].data.push({name:i,value:c})})}else h.value.legend.data=s.map(o=>o.data),h.value.series[0].data=s.map(o=>({name:o.data,value:o.count}))}}}),d=T({timeStep:"day",range:[p().startOf("day").add(-7,"day").toDate(),new Date]}),b=I({xAxis:{type:"time",max:"dataMax"},yAxis:{type:"value"},tooltip:{trigger:"axis"},series:[{data:[],type:"line",name:l("page.charts.line.options.field")}]});A(d,n=>{L(n.range[0],n.range[1],n.timeStep)});const{loading:F,run:L}=B(q,{defaultParams:[p().startOf("day").add(-7,"day").toDate(),new Date,"day"],onSuccess:n=>{if(n.data){const s=new Map;for(let o=p(d.range[0]);o.isBefore(p(d.range[1]));o=o.add(1,d.timeStep))s.set(o.valueOf(),0);n.data.forEach(o=>{s.set(p(o.timestamp).startOf(d.timeStep).valueOf(),o.count)}),b.value.series[0].data=Array.from(s).sort(([o],[i])=>o-i).map(([o,i])=>[new Date(o),i])}}});return(n,s)=>{const o=ne,i=re,c=de,u=ie,N=pe,x=ue,w=me,D=ce,S=fe,y=ge,j=he,O=_e,V=ye,k=ve,z=se;return P(),E(z,{justify:"center",align:"stretch",wrap:!0,gutter:[{xs:12,sm:12,md:12,lg:12,xl:24},{xs:12,sm:12,md:12,lg:12,xl:24}]},{default:e(()=>[t(S,{xl:12,lg:24,md:24,sm:24,xs:24},{default:e(()=>[t(D,{hoverable:"",title:a(l)("page.charts.title.line")},{extra:e(()=>[t(w,null,{content:e(()=>[t(x,{model:d},{default:e(()=>[t(u,{field:"timeStep",label:a(l)("page.charts.options.steps"),"label-col-flex":"100px"},{default:e(()=>[t(c,{modelValue:d.timeStep,"onUpdate:modelValue":s[0]||(s[0]=m=>d.timeStep=m),onChange:s[1]||(s[1]=m=>R(m))},{default:e(()=>[t(i,{value:"day"},{default:e(()=>[f(g(a(l)("page.charts.options.day")),1)]),_:1}),t(i,{value:"hour"},{default:e(()=>[f(g(a(l)("page.charts.options.hour")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(u,{field:"range",label:a(l)("page.charts.options.days"),"label-col-flex":"100px"},{default:e(()=>[t(N,{"show-time":"",modelValue:d.range,"onUpdate:modelValue":s[2]||(s[2]=m=>d.range=m),"value-format":"Date",shortcuts:d.timeStep==="day"?[{label:a(l)("page.charts.options.shortcut.7days"),value:()=>[a(p)().startOf("day").add(-7,"day").toDate(),new Date]},{label:a(l)("page.charts.options.shortcut.14days"),value:()=>[a(p)().startOf("day").add(-14,"day").toDate(),new Date]},{label:a(l)("page.charts.options.shortcut.30days"),value:()=>[a(p)().startOf("day").add(-30,"day").toDate(),new Date]}]:[{label:a(l)("page.charts.options.shortcut.6hours"),value:()=>[a(p)().startOf("hour").add(-6,"hour").toDate(),new Date]},{label:a(l)("page.charts.options.shortcut.12hours"),value:()=>[a(p)().startOf("hour").add(-12,"hour").toDate(),new Date]},{label:a(l)("page.charts.options.shortcut.24hours"),value:()=>[a(p)().startOf("hour").add(-24,"hour").toDate(),new Date]}]},null,8,["modelValue","shortcuts"])]),_:1},8,["label"])]),_:1},8,["model"])]),default:e(()=>[t(o,null,{default:e(()=>[f(g(a(l)("page.charts.options.more")),1)]),_:1})]),_:1})]),default:e(()=>[t(a(C),{class:"chart",option:b.value,loading:a(F),loadingOptions:v.value,theme:"ovilia-green",autoresize:"","init-options":{renderer:"svg"}},null,8,["option","loading","loadingOptions"])]),_:1},8,["title"])]),_:1}),t(S,{xl:12,lg:24,md:24,sm:24,xs:24},{default:e(()=>[t(D,{hoverable:"",title:a(l)("page.charts.options.field."+r.field)},{extra:e(()=>[t(w,null,{content:e(()=>[t(x,{model:r,style:{width:"25vh"}},{default:e(()=>[t(u,{field:"field",label:a(l)("page.charts.options.field")},{default:e(()=>[t(j,{modelValue:r.field,"onUpdate:modelValue":s[3]||(s[3]=m=>r.field=m),"trigger-props":{autoFitPopupMinWidth:!0}},{default:e(()=>[t(y,{value:"peerId"},{default:e(()=>[f(g(a(l)("page.charts.options.field.peerId")),1)]),_:1}),t(y,{value:"torrentName"},{default:e(()=>[f(g(a(l)("page.charts.options.field.torrentName")),1)]),_:1}),t(y,{value:"module"},{default:e(()=>[f(g(a(l)("page.charts.options.field.module")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(u,{field:"enableThreshold"},{default:e(()=>[t(k,null,{default:e(()=>[t(O,{modelValue:r.enableThreshold,"onUpdate:modelValue":s[4]||(s[4]=m=>r.enableThreshold=m)},null,8,["modelValue"]),t(V,null,{default:e(()=>[f(g(a(l)("page.charts.options.thresold")),1)]),_:1})]),_:1})]),_:1}),r.field==="peerId"?(P(),E(u,{key:0,field:"mergeSameVersion"},{default:e(()=>[t(k,null,{default:e(()=>[t(O,{modelValue:r.mergeSameVersion,"onUpdate:modelValue":s[5]||(s[5]=m=>r.mergeSameVersion=m)},null,8,["modelValue"]),t(V,null,{default:e(()=>[f(g(a(l)("page.charts.options.mergeSame")),1)]),_:1})]),_:1})]),_:1})):le("",!0)]),_:1},8,["model"])]),default:e(()=>[t(o,null,{default:e(()=>[f(g(a(l)("page.charts.options.more")),1)]),_:1})]),_:1})]),default:e(()=>[t(a(C),{class:"chart",option:h.value,loading:a(U),autoresize:"",loadingOptions:v.value,theme:a(_).isDark?"dark":"light","init-options":{renderer:"svg"}},null,8,["option","loading","loadingOptions","theme"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Ve=W(be,[["__scopeId","data-v-0c17047e"]]);export{Ve as default};
