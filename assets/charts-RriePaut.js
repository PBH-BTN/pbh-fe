import{u as B,g as M,_ as N}from"./index-CMgAiMV7.js";import{u as E,H as w,i as L,a as j,b as z,c as P,d as U,e as q,f as H}from"./echarts-CeIfDHi3.js";import{e as R,a6 as W,a as X,c as O,a7 as Y,r as G,h as T,q as J,C as e,v as a,a2 as s,y as c,N as f,j as K,F as Q,O as Z}from"./libs-CfNwz28r.js";import{ah as g,L as ee,W as ae,X as te,F as oe,Y as le,T as se,S as ne,u as re,ai as de,C as ie,w as ue,x as pe}from"./arcoDesign-COq-vaMw.js";const ce=R({__name:"charts",setup(fe){const{t:d,d:V}=W();E([L,j,z,P,U,q,H]);const b=B(),u=X({field:"peerId",enableThreshold:!0}),C={text:"Loadingâ€¦",color:"#4ea397",maskColor:"rgba(255, 255, 255, 0.4)"},D=O(()=>{const i={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"right",type:"scroll",right:10,top:20,bottom:20,data:[]},backgroundColor:b.isDark?"rgba(0, 0, 0, 0.0)":void 0,series:[{name:d("page.banlog.charts.options.field."+u.field),type:"pie",radius:"55%",center:["50%","60%"],data:[],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};if(_.value){const n=new Map;_.value.results.forEach(t=>{const o=t[u.field];n.has(o)?n.set(o,n.get(o)+1):n.set(o,1)}),i.series[0].data=Array.from(n,([t,o])=>({name:t,value:o})),u.enableThreshold&&(i.series[0].data=i.series[0].data.filter(o=>o.value/_.value.results.length>.01)),i.legend.data=i.series[0].data.map(t=>t.name)}return i}),{loading:A,data:_}=Y(M,{defaultParams:[{pageIndex:1,pageSize:1e5}]}),m=G(7),S=O(()=>{const i={xAxis:{type:"category",data:[]},yAxis:{type:"value"},tooltip:{trigger:"axis"},series:[{data:[],type:"line",smooth:!0,name:d("page.banlog.charts.line.options.field")}]};if(_.value){new Date().setHours(0,0,0);const t=new Map;for(let l=m.value;l>=0;l--){const r=g().add(-1*l,"day").startOf("day");t.set(r.valueOf(),0)}const o=g().add(-1*m.value,"day").startOf("day");_.value.results.filter(l=>g(l.banAt).isAfter(o)).sort((l,r)=>l.banAt-r.banAt).forEach(l=>{const r=g(l.banAt).startOf("day").valueOf();t.has(r)?t.set(r,t.get(r)+1):t.set(r,1)}),t.forEach((l,r)=>{i.xAxis.data.push(V(r,"short")),i.series[0].data.push(l)})}return i});return(i,n)=>{const t=ee,o=ae,h=te,l=oe,r=le,I=se,F=ne,v=re,y=de,x=ie,k=ue,$=pe;return T(),J($,{justify:"center",align:"stretch",wrap:!0,gutter:[{xs:12,sm:12,md:12,lg:12,xl:24},{xs:12,sm:12,md:12,lg:12,xl:24}]},{default:e(()=>[a(k,{xl:12,lg:24,md:24,sm:24,xs:24},{default:e(()=>[a(x,{hoverable:"",title:s(d)("page.banlog.charts.options.field."+u.field)},{extra:e(()=>[a(y,null,{content:e(()=>[a(v,{model:u,style:{width:"25vh"}},{default:e(()=>[a(l,{field:"field",label:s(d)("page.banlog.charts.options.field")},{default:e(()=>[a(h,{modelValue:u.field,"onUpdate:modelValue":n[0]||(n[0]=p=>u.field=p),"trigger-props":{autoFitPopupMinWidth:!0}},{default:e(()=>[a(o,{value:"peerId"},{default:e(()=>[c(f(s(d)("page.banlog.charts.options.field.peerId")),1)]),_:1}),a(o,{value:"torrentName"},{default:e(()=>[c(f(s(d)("page.banlog.charts.options.field.torrentName")),1)]),_:1}),a(o,{value:"module"},{default:e(()=>[c(f(s(d)("page.banlog.charts.options.field.module")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(l,{field:"enableThreshold"},{default:e(()=>[a(F,null,{default:e(()=>[a(r,{modelValue:u.enableThreshold,"onUpdate:modelValue":n[1]||(n[1]=p=>u.enableThreshold=p)},null,8,["modelValue"]),a(I,null,{default:e(()=>[c(f(s(d)("page.banlog.charts.options.thresold")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),default:e(()=>[a(t,null,{default:e(()=>[c(f(s(d)("page.banlog.charts.options.more")),1)]),_:1})]),_:1})]),default:e(()=>[a(s(w),{class:"chart",option:D.value,loading:s(A),autoresize:"",loadingOptions:C,theme:s(b).isDark?"dark":"light","init-options":{renderer:"svg"}},null,8,["option","loading","theme"])]),_:1},8,["title"])]),_:1}),a(k,{xl:12,lg:24,md:24,sm:24,xs:24},{default:e(()=>[a(x,{hoverable:"",title:s(d)("page.banlog.charts.title.line",{days:m.value})},{extra:e(()=>[a(y,null,{content:e(()=>[a(v,{model:{lastDays:m.value},style:{width:"25vh"}},{default:e(()=>[a(l,{field:"field",label:s(d)("page.banlog.charts.options.days"),"label-col-flex":"100px"},{default:e(()=>[a(h,{modelValue:m.value,"onUpdate:modelValue":n[2]||(n[2]=p=>m.value=p)},{default:e(()=>[(T(),K(Q,null,Z([7,14,30],p=>a(o,{key:p,value:p},{default:e(()=>[c(f(p),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),default:e(()=>[a(t,null,{default:e(()=>[c(f(s(d)("page.banlog.charts.options.more")),1)]),_:1})]),_:1})]),default:e(()=>[a(s(w),{class:"chart",option:S.value,theme:"ovilia-green",autoresize:"","init-options":{renderer:"svg"}},null,8,["option"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),be=N(ce,[["__scopeId","data-v-3b20a410"]]);export{be as default};
