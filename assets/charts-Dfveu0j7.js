import{u as j,g as q,a as W,_ as X}from"./index-ICRxhnZ6.js";import{u as G,H as C,i as H,a as J,b as K,c as Q,d as Y,e as Z,f as ee}from"./echarts-TgJrjpti.js";import{e as ae,a6 as te,a as T,r as I,w as A,a7 as L,h as N,q as P,C as e,v as t,a2 as a,y as g,N as f,s as oe}from"./libs-DfNW6cuU.js";import{ag as i,L as le,V as se,W as ne,F as re,X as de,T as ie,S as pe,t as ue,ah as me,C as ce,v as ge,R as fe,r as he,ai as _e,w as be}from"./arcoDesign-C47bOjOX.js";const ye=ae({__name:"charts",setup(ve){const{t:l}=te();G([H,J,K,Q,Y,Z,ee]);const _=j(),r=T({field:"peerId",enableThreshold:!0,mergeSameVersion:!1}),b={text:"Loadingâ€¦",color:"#4ea397",maskColor:"rgba(255, 255, 255, 0.4)"},h=I({tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"right",type:"scroll",right:10,top:20,bottom:20,data:[],textStyle:{overflow:"truncate",width:100},tooltip:{show:!0}},backgroundColor:_.isDark?"rgba(0, 0, 0, 0.0)":void 0,series:[{name:l("page.banlog.charts.options.field."+r.field),type:"pie",radius:"55%",center:["50%","60%"],data:[],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),R=n=>{n==="day"?d.range=[i().startOf("day").add(-7,"day").toDate(),new Date]:d.range=[i().startOf("hour").add(-6,"hour").toDate(),new Date]};A(r,n=>{B(n.field,n.enableThreshold)});const{loading:$,run:B}=L(q,{defaultParams:["peerId",!0],onSuccess:n=>{if(n){const s=n.map(o=>(o.data===""&&(o.data=l("page.banlog.charts.options.field.empty")),o));if(r.mergeSameVersion&&r.field==="peerId"){const o=new Map;s.forEach(p=>{let c=p.data;const u=c.match(/^([-]?[a-zA-z]+)[0-9]+.*/);u&&(u==null?void 0:u.length)>=2&&(c=u[1]+"*"),o.has(c)?o.set(c,o.get(c)+p.count):o.set(c,p.count)}),h.value.legend.data=[],h.value.series[0].data=[],Array.from(o).forEach(([p,c])=>{h.value.legend.data.push(p),h.value.series[0].data.push({name:p,value:c})})}else h.value.legend.data=s.map(o=>o.data),h.value.series[0].data=s.map(o=>({name:o.data,value:o.count}))}}}),d=T({timeStep:"day",range:[i().startOf("day").add(-7,"day").toDate(),new Date]}),y=I({xAxis:{type:"time"},yAxis:{type:"value"},tooltip:{trigger:"axis"},series:[{data:[],type:"line",smooth:!0,name:l("page.banlog.charts.line.options.field")}]});A(d,n=>{U(n.range[0],n.range[1],n.timeStep)});const{loading:F,run:U}=L(W,{defaultParams:[i().startOf("day").add(-7,"day").toDate(),new Date,"day"],onSuccess:n=>{if(n){const s=new Map;for(let o=i(d.range[0]);o.isBefore(i(d.range[1]));o=o.add(1,d.timeStep))s.set(o.valueOf(),0);n.forEach(o=>{s.set(i(o.timestamp).startOf(d.timeStep).valueOf(),o.count)}),y.value.series[0].data=Array.from(s).map(([o,p])=>[new Date(o),p])}}});return(n,s)=>{const o=le,p=se,c=ne,u=re,v=de,w=ie,D=pe,x=ue,S=me,V=ce,O=ge,k=fe,z=he,E=_e,M=be;return N(),P(M,{justify:"center",align:"stretch",wrap:!0,gutter:[{xs:12,sm:12,md:12,lg:12,xl:24},{xs:12,sm:12,md:12,lg:12,xl:24}]},{default:e(()=>[t(O,{xl:12,lg:24,md:24,sm:24,xs:24},{default:e(()=>[t(V,{hoverable:"",title:a(l)("page.banlog.charts.options.field."+r.field)},{extra:e(()=>[t(S,null,{content:e(()=>[t(x,{model:r,style:{width:"25vh"}},{default:e(()=>[t(u,{field:"field",label:a(l)("page.banlog.charts.options.field")},{default:e(()=>[t(c,{modelValue:r.field,"onUpdate:modelValue":s[0]||(s[0]=m=>r.field=m),"trigger-props":{autoFitPopupMinWidth:!0}},{default:e(()=>[t(p,{value:"peerId"},{default:e(()=>[g(f(a(l)("page.banlog.charts.options.field.peerId")),1)]),_:1}),t(p,{value:"torrentName"},{default:e(()=>[g(f(a(l)("page.banlog.charts.options.field.torrentName")),1)]),_:1}),t(p,{value:"module"},{default:e(()=>[g(f(a(l)("page.banlog.charts.options.field.module")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(u,{field:"enableThreshold"},{default:e(()=>[t(D,null,{default:e(()=>[t(v,{modelValue:r.enableThreshold,"onUpdate:modelValue":s[1]||(s[1]=m=>r.enableThreshold=m)},null,8,["modelValue"]),t(w,null,{default:e(()=>[g(f(a(l)("page.banlog.charts.options.thresold")),1)]),_:1})]),_:1})]),_:1}),r.field==="peerId"?(N(),P(u,{key:0,field:"mergeSameVersion"},{default:e(()=>[t(D,null,{default:e(()=>[t(v,{modelValue:r.mergeSameVersion,"onUpdate:modelValue":s[2]||(s[2]=m=>r.mergeSameVersion=m)},null,8,["modelValue"]),t(w,null,{default:e(()=>[g(f(a(l)("page.banlog.charts.options.mergeSame")),1)]),_:1})]),_:1})]),_:1})):oe("",!0)]),_:1},8,["model"])]),default:e(()=>[t(o,null,{default:e(()=>[g(f(a(l)("page.banlog.charts.options.more")),1)]),_:1})]),_:1})]),default:e(()=>[t(a(C),{class:"chart",option:h.value,loading:a($),autoresize:"",loadingOptions:b,theme:a(_).isDark?"dark":"light","init-options":{renderer:"svg"}},null,8,["option","loading","theme"])]),_:1},8,["title"])]),_:1}),t(O,{xl:12,lg:24,md:24,sm:24,xs:24},{default:e(()=>[t(V,{hoverable:"",title:a(l)("page.banlog.charts.title.line")},{extra:e(()=>[t(S,null,{content:e(()=>[t(x,{model:d},{default:e(()=>[t(u,{field:"timeStep",label:a(l)("page.banlog.charts.options.steps"),"label-col-flex":"100px"},{default:e(()=>[t(z,{modelValue:d.timeStep,"onUpdate:modelValue":s[3]||(s[3]=m=>d.timeStep=m),onChange:s[4]||(s[4]=m=>R(m))},{default:e(()=>[t(k,{value:"day"},{default:e(()=>[g(f(a(l)("page.banlog.charts.options.day")),1)]),_:1}),t(k,{value:"hour"},{default:e(()=>[g(f(a(l)("page.banlog.charts.options.hour")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(u,{field:"range",label:a(l)("page.banlog.charts.options.days"),"label-col-flex":"100px"},{default:e(()=>[t(E,{"show-time":"",modelValue:d.range,"onUpdate:modelValue":s[5]||(s[5]=m=>d.range=m),"value-format":"Date",shortcuts:d.timeStep==="day"?[{label:a(l)("page.banlog.charts.options.shortcut.7days"),value:()=>[a(i)().startOf("day").add(-7,"day").toDate(),new Date]},{label:a(l)("page.banlog.charts.options.shortcut.14days"),value:()=>[a(i)().startOf("day").add(-14,"day").toDate(),new Date]},{label:a(l)("page.banlog.charts.options.shortcut.30days"),value:()=>[a(i)().startOf("day").add(-30,"day").toDate(),new Date]}]:[{label:a(l)("page.banlog.charts.options.shortcut.6hours"),value:()=>[a(i)().startOf("hour").add(-6,"hour").toDate(),new Date]},{label:a(l)("page.banlog.charts.options.shortcut.12hours"),value:()=>[a(i)().startOf("hour").add(-12,"hour").toDate(),new Date]},{label:a(l)("page.banlog.charts.options.shortcut.24hours"),value:()=>[a(i)().startOf("hour").add(-24,"hour").toDate(),new Date]}]},null,8,["modelValue","shortcuts"])]),_:1},8,["label"])]),_:1},8,["model"])]),default:e(()=>[t(o,null,{default:e(()=>[g(f(a(l)("page.banlog.charts.options.more")),1)]),_:1})]),_:1})]),default:e(()=>[t(a(C),{class:"chart",option:y.value,loading:a(F),loadingOptions:b,theme:"ovilia-green",autoresize:"","init-options":{renderer:"svg"}},null,8,["option","loading"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Ve=X(ye,[["__scopeId","data-v-46343e0c"]]);export{Ve as default};
