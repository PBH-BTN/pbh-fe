import{u as j,g as q,a as W,_ as X}from"./index-C6KdxjWx.js";import{u as G,H as C,i as H,a as J,b as K,c as Q,d as Y,e as Z,f as ee}from"./echarts-TgJrjpti.js";import{e as ae,a6 as te,a as T,c as oe,r as I,w as A,a7 as B,h as N,q as P,C as e,v as t,a2 as a,y as c,N as f,s as le}from"./libs-DfNW6cuU.js";import{ag as i,L as se,R as ne,r as re,F as de,ah as ie,t as pe,ai as ue,C as ge,v as me,V as ce,W as fe,X as he,T as _e,S as be,w as ye}from"./arcoDesign-amu4IFh0.js";const ve=ae({__name:"charts",setup(we){const{t:l}=te();G([H,J,K,Q,Y,Z,ee]);const _=j(),r=T({field:"peerId",enableThreshold:!0,mergeSameVersion:!1}),y=oe(()=>({text:l("page.banlog.charts.loading"),color:_.isDark?"rgb(60, 126, 255)":"rgb(22, 93, 255)",textColor:_.isDark?"rgba(255, 255, 255, 0.9)":"rgb(29, 33, 41)",maskColor:_.isDark?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"})),h=I({tooltip:{trigger:"item",appendToBody:!0,formatter:'<p style="word-wrap:break-all"><b>{b}</b></p>  {c} ({d}%)'},legend:{orient:"vertical",left:"right",type:"scroll",right:10,top:20,bottom:20,data:[],textStyle:{overflow:"truncate",width:100},tooltip:{show:!0}},backgroundColor:_.isDark?"rgba(0, 0, 0, 0.0)":void 0,series:[{name:l("page.banlog.charts.options.field."+r.field),type:"pie",radius:"55%",center:["50%","60%"],data:[],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),R=n=>{n==="day"?d.range=[i().startOf("day").add(-7,"day").toDate(),new Date]:d.range=[i().startOf("hour").add(-6,"hour").toDate(),new Date]};A(r,n=>{F(n.field,n.enableThreshold)});const{loading:$,run:F}=B(q,{defaultParams:["peerId",!0],onSuccess:n=>{if(n.data){const s=n.data.map(o=>(o.data===""&&(o.data=l("page.banlog.charts.options.field.empty")),o));if(r.mergeSameVersion&&r.field==="peerId"){const o=new Map;s.forEach(p=>{let m=p.data;const u=m.match(/^([-]?[a-zA-z]+)[0-9]+.*/);u&&(u==null?void 0:u.length)>=2&&(m=u[1]+"*"),o.has(m)?o.set(m,o.get(m)+p.count):o.set(m,p.count)}),h.value.legend.data=[],h.value.series[0].data=[],Array.from(o).forEach(([p,m])=>{h.value.legend.data.push(p),h.value.series[0].data.push({name:p,value:m})})}else h.value.legend.data=s.map(o=>o.data),h.value.series[0].data=s.map(o=>({name:o.data,value:o.count}))}}}),d=T({timeStep:"day",range:[i().startOf("day").add(-7,"day").toDate(),new Date]}),v=I({xAxis:{type:"time"},yAxis:{type:"value"},tooltip:{trigger:"axis"},series:[{data:[],type:"line",smooth:!0,name:l("page.banlog.charts.line.options.field")}]});A(d,n=>{U(n.range[0],n.range[1],n.timeStep)});const{loading:L,run:U}=B(W,{defaultParams:[i().startOf("day").add(-7,"day").toDate(),new Date,"day"],onSuccess:n=>{if(n.data){const s=new Map;for(let o=i(d.range[0]);o.isBefore(i(d.range[1]));o=o.add(1,d.timeStep))s.set(o.valueOf(),0);n.data.forEach(o=>{s.set(i(o.timestamp).startOf(d.timeStep).valueOf(),o.count)}),v.value.series[0].data=Array.from(s).map(([o,p])=>[new Date(o),p])}}});return(n,s)=>{const o=se,p=ne,m=re,u=de,z=ie,w=pe,D=ue,x=ge,S=me,b=ce,E=fe,O=he,V=_e,k=be,M=ye;return N(),P(M,{justify:"center",align:"stretch",wrap:!0,gutter:[{xs:12,sm:12,md:12,lg:12,xl:24},{xs:12,sm:12,md:12,lg:12,xl:24}]},{default:e(()=>[t(S,{xl:12,lg:24,md:24,sm:24,xs:24},{default:e(()=>[t(x,{hoverable:"",title:a(l)("page.banlog.charts.title.line")},{extra:e(()=>[t(D,null,{content:e(()=>[t(w,{model:d},{default:e(()=>[t(u,{field:"timeStep",label:a(l)("page.banlog.charts.options.steps"),"label-col-flex":"100px"},{default:e(()=>[t(m,{modelValue:d.timeStep,"onUpdate:modelValue":s[0]||(s[0]=g=>d.timeStep=g),onChange:s[1]||(s[1]=g=>R(g))},{default:e(()=>[t(p,{value:"day"},{default:e(()=>[c(f(a(l)("page.banlog.charts.options.day")),1)]),_:1}),t(p,{value:"hour"},{default:e(()=>[c(f(a(l)("page.banlog.charts.options.hour")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(u,{field:"range",label:a(l)("page.banlog.charts.options.days"),"label-col-flex":"100px"},{default:e(()=>[t(z,{"show-time":"",modelValue:d.range,"onUpdate:modelValue":s[2]||(s[2]=g=>d.range=g),"value-format":"Date",shortcuts:d.timeStep==="day"?[{label:a(l)("page.banlog.charts.options.shortcut.7days"),value:()=>[a(i)().startOf("day").add(-7,"day").toDate(),new Date]},{label:a(l)("page.banlog.charts.options.shortcut.14days"),value:()=>[a(i)().startOf("day").add(-14,"day").toDate(),new Date]},{label:a(l)("page.banlog.charts.options.shortcut.30days"),value:()=>[a(i)().startOf("day").add(-30,"day").toDate(),new Date]}]:[{label:a(l)("page.banlog.charts.options.shortcut.6hours"),value:()=>[a(i)().startOf("hour").add(-6,"hour").toDate(),new Date]},{label:a(l)("page.banlog.charts.options.shortcut.12hours"),value:()=>[a(i)().startOf("hour").add(-12,"hour").toDate(),new Date]},{label:a(l)("page.banlog.charts.options.shortcut.24hours"),value:()=>[a(i)().startOf("hour").add(-24,"hour").toDate(),new Date]}]},null,8,["modelValue","shortcuts"])]),_:1},8,["label"])]),_:1},8,["model"])]),default:e(()=>[t(o,null,{default:e(()=>[c(f(a(l)("page.banlog.charts.options.more")),1)]),_:1})]),_:1})]),default:e(()=>[t(a(C),{class:"chart",option:v.value,loading:a(L),loadingOptions:y.value,theme:"ovilia-green",autoresize:"","init-options":{renderer:"svg"}},null,8,["option","loading","loadingOptions"])]),_:1},8,["title"])]),_:1}),t(S,{xl:12,lg:24,md:24,sm:24,xs:24},{default:e(()=>[t(x,{hoverable:"",title:a(l)("page.banlog.charts.options.field."+r.field)},{extra:e(()=>[t(D,null,{content:e(()=>[t(w,{model:r,style:{width:"25vh"}},{default:e(()=>[t(u,{field:"field",label:a(l)("page.banlog.charts.options.field")},{default:e(()=>[t(E,{modelValue:r.field,"onUpdate:modelValue":s[3]||(s[3]=g=>r.field=g),"trigger-props":{autoFitPopupMinWidth:!0}},{default:e(()=>[t(b,{value:"peerId"},{default:e(()=>[c(f(a(l)("page.banlog.charts.options.field.peerId")),1)]),_:1}),t(b,{value:"torrentName"},{default:e(()=>[c(f(a(l)("page.banlog.charts.options.field.torrentName")),1)]),_:1}),t(b,{value:"module"},{default:e(()=>[c(f(a(l)("page.banlog.charts.options.field.module")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(u,{field:"enableThreshold"},{default:e(()=>[t(k,null,{default:e(()=>[t(O,{modelValue:r.enableThreshold,"onUpdate:modelValue":s[4]||(s[4]=g=>r.enableThreshold=g)},null,8,["modelValue"]),t(V,null,{default:e(()=>[c(f(a(l)("page.banlog.charts.options.thresold")),1)]),_:1})]),_:1})]),_:1}),r.field==="peerId"?(N(),P(u,{key:0,field:"mergeSameVersion"},{default:e(()=>[t(k,null,{default:e(()=>[t(O,{modelValue:r.mergeSameVersion,"onUpdate:modelValue":s[5]||(s[5]=g=>r.mergeSameVersion=g)},null,8,["modelValue"]),t(V,null,{default:e(()=>[c(f(a(l)("page.banlog.charts.options.mergeSame")),1)]),_:1})]),_:1})]),_:1})):le("",!0)]),_:1},8,["model"])]),default:e(()=>[t(o,null,{default:e(()=>[c(f(a(l)("page.banlog.charts.options.more")),1)]),_:1})]),_:1})]),default:e(()=>[t(a(C),{class:"chart",option:h.value,loading:a($),autoresize:"",loadingOptions:y.value,theme:a(_).isDark?"dark":"light","init-options":{renderer:"svg"}},null,8,["option","loading","loadingOptions","theme"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Ve=X(ve,[["__scopeId","data-v-c67be704"]]);export{Ve as default};
