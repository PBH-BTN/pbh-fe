import{a as j,g as q,b as W,c as X}from"./index-Bguw84cs.js";import{u as G,E as C,i as H,a as J,b as K,c as Q,d as Y,e as Z,f as aa}from"./echarts-BYA5FaEY.js";import{e as ea,a6 as ta,a as T,c as oa,r as I,w as A,a7 as B,h as E,q as N,C as a,v as t,a2 as e,y as c,N as f,s as la}from"./libs-BL3g9QDj.js";import{ak as p,L as sa,R as na,r as ra,F as da,al as ia,t as pa,am as ua,C as ga,v as ma,V as ca,W as fa,X as ha,T as _a,S as ba,w as ya}from"./arcoDesign-DpSAeax-.js";const va=ea({__name:"charts",setup(wa){const{t:l}=ta();G([H,J,K,Q,Y,Z,aa]);const _=j(),r=T({field:"peerId",enableThreshold:!0,mergeSameVersion:!1}),y=oa(()=>({text:l("page.banlog.charts.loading"),color:_.isDark?"rgb(60, 126, 255)":"rgb(22, 93, 255)",textColor:_.isDark?"rgba(255, 255, 255, 0.9)":"rgb(29, 33, 41)",maskColor:_.isDark?"rgba(0, 0, 0, 0.4)":"rgba(255, 255, 255, 0.4)"})),h=I({tooltip:{trigger:"item",appendToBody:!0,formatter:'<p style="word-wrap:break-all"><b>{b}</b></p>  {c} ({d}%)'},legend:{orient:"vertical",left:"right",type:"scroll",right:10,top:20,bottom:20,data:[],textStyle:{overflow:"truncate",width:100},tooltip:{show:!0}},backgroundColor:_.isDark?"rgba(0, 0, 0, 0.0)":void 0,series:[{name:l("page.banlog.charts.options.field."+r.field),type:"pie",radius:"55%",center:["50%","60%"],data:[],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),P=n=>{n==="day"?d.range=[p().startOf("day").add(-7,"day").toDate(),new Date]:d.range=[p().startOf("hour").add(-6,"hour").toDate(),new Date]};A(r,n=>{$(n.field,n.enableThreshold)});const{loading:R,run:$}=B(q,{defaultParams:["peerId",!0],onSuccess:n=>{if(n.data){const s=n.data.map(o=>(o.data===""&&(o.data=l("page.banlog.charts.options.field.empty")),o));if(r.mergeSameVersion&&r.field==="peerId"){const o=new Map;s.forEach(i=>{let m=i.data;const u=m.match(/^([-]?[a-zA-z]+)[0-9]+.*/);u&&(u==null?void 0:u.length)>=2&&(m=u[1]+"*"),o.has(m)?o.set(m,o.get(m)+i.count):o.set(m,i.count)}),h.value.legend.data=[],h.value.series[0].data=[],Array.from(o).forEach(([i,m])=>{h.value.legend.data.push(i),h.value.series[0].data.push({name:i,value:m})})}else h.value.legend.data=s.map(o=>o.data),h.value.series[0].data=s.map(o=>({name:o.data,value:o.count}))}}}),d=T({timeStep:"day",range:[p().startOf("day").add(-7,"day").toDate(),new Date]}),v=I({xAxis:{type:"time",max:"dataMax"},yAxis:{type:"value"},tooltip:{trigger:"axis"},series:[{data:[],type:"line",name:l("page.banlog.charts.line.options.field")}]});A(d,n=>{L(n.range[0],n.range[1],n.timeStep)});const{loading:F,run:L}=B(W,{defaultParams:[p().startOf("day").add(-7,"day").toDate(),new Date,"day"],onSuccess:n=>{if(n.data){const s=new Map;for(let o=p(d.range[0]);o.isBefore(p(d.range[1]));o=o.add(1,d.timeStep))s.set(o.valueOf(),0);n.data.forEach(o=>{s.set(p(o.timestamp).startOf(d.timeStep).valueOf(),o.count)}),v.value.series[0].data=Array.from(s).sort(([o],[i])=>o-i).map(([o,i])=>[new Date(o),i])}}});return(n,s)=>{const o=sa,i=na,m=ra,u=da,U=ia,w=pa,D=ua,x=ga,S=ma,b=ca,z=fa,O=ha,V=_a,k=ba,M=ya;return E(),N(M,{justify:"center",align:"stretch",wrap:!0,gutter:[{xs:12,sm:12,md:12,lg:12,xl:24},{xs:12,sm:12,md:12,lg:12,xl:24}]},{default:a(()=>[t(S,{xl:12,lg:24,md:24,sm:24,xs:24},{default:a(()=>[t(x,{hoverable:"",title:e(l)("page.banlog.charts.title.line")},{extra:a(()=>[t(D,null,{content:a(()=>[t(w,{model:d},{default:a(()=>[t(u,{field:"timeStep",label:e(l)("page.banlog.charts.options.steps"),"label-col-flex":"100px"},{default:a(()=>[t(m,{modelValue:d.timeStep,"onUpdate:modelValue":s[0]||(s[0]=g=>d.timeStep=g),onChange:s[1]||(s[1]=g=>P(g))},{default:a(()=>[t(i,{value:"day"},{default:a(()=>[c(f(e(l)("page.banlog.charts.options.day")),1)]),_:1}),t(i,{value:"hour"},{default:a(()=>[c(f(e(l)("page.banlog.charts.options.hour")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(u,{field:"range",label:e(l)("page.banlog.charts.options.days"),"label-col-flex":"100px"},{default:a(()=>[t(U,{"show-time":"",modelValue:d.range,"onUpdate:modelValue":s[2]||(s[2]=g=>d.range=g),"value-format":"Date",shortcuts:d.timeStep==="day"?[{label:e(l)("page.banlog.charts.options.shortcut.7days"),value:()=>[e(p)().startOf("day").add(-7,"day").toDate(),new Date]},{label:e(l)("page.banlog.charts.options.shortcut.14days"),value:()=>[e(p)().startOf("day").add(-14,"day").toDate(),new Date]},{label:e(l)("page.banlog.charts.options.shortcut.30days"),value:()=>[e(p)().startOf("day").add(-30,"day").toDate(),new Date]}]:[{label:e(l)("page.banlog.charts.options.shortcut.6hours"),value:()=>[e(p)().startOf("hour").add(-6,"hour").toDate(),new Date]},{label:e(l)("page.banlog.charts.options.shortcut.12hours"),value:()=>[e(p)().startOf("hour").add(-12,"hour").toDate(),new Date]},{label:e(l)("page.banlog.charts.options.shortcut.24hours"),value:()=>[e(p)().startOf("hour").add(-24,"hour").toDate(),new Date]}]},null,8,["modelValue","shortcuts"])]),_:1},8,["label"])]),_:1},8,["model"])]),default:a(()=>[t(o,null,{default:a(()=>[c(f(e(l)("page.banlog.charts.options.more")),1)]),_:1})]),_:1})]),default:a(()=>[t(e(C),{class:"chart",option:v.value,loading:e(F),loadingOptions:y.value,theme:"ovilia-green",autoresize:"","init-options":{renderer:"svg"}},null,8,["option","loading","loadingOptions"])]),_:1},8,["title"])]),_:1}),t(S,{xl:12,lg:24,md:24,sm:24,xs:24},{default:a(()=>[t(x,{hoverable:"",title:e(l)("page.banlog.charts.options.field."+r.field)},{extra:a(()=>[t(D,null,{content:a(()=>[t(w,{model:r,style:{width:"25vh"}},{default:a(()=>[t(u,{field:"field",label:e(l)("page.banlog.charts.options.field")},{default:a(()=>[t(z,{modelValue:r.field,"onUpdate:modelValue":s[3]||(s[3]=g=>r.field=g),"trigger-props":{autoFitPopupMinWidth:!0}},{default:a(()=>[t(b,{value:"peerId"},{default:a(()=>[c(f(e(l)("page.banlog.charts.options.field.peerId")),1)]),_:1}),t(b,{value:"torrentName"},{default:a(()=>[c(f(e(l)("page.banlog.charts.options.field.torrentName")),1)]),_:1}),t(b,{value:"module"},{default:a(()=>[c(f(e(l)("page.banlog.charts.options.field.module")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(u,{field:"enableThreshold"},{default:a(()=>[t(k,null,{default:a(()=>[t(O,{modelValue:r.enableThreshold,"onUpdate:modelValue":s[4]||(s[4]=g=>r.enableThreshold=g)},null,8,["modelValue"]),t(V,null,{default:a(()=>[c(f(e(l)("page.banlog.charts.options.thresold")),1)]),_:1})]),_:1})]),_:1}),r.field==="peerId"?(E(),N(u,{key:0,field:"mergeSameVersion"},{default:a(()=>[t(k,null,{default:a(()=>[t(O,{modelValue:r.mergeSameVersion,"onUpdate:modelValue":s[5]||(s[5]=g=>r.mergeSameVersion=g)},null,8,["modelValue"]),t(V,null,{default:a(()=>[c(f(e(l)("page.banlog.charts.options.mergeSame")),1)]),_:1})]),_:1})]),_:1})):la("",!0)]),_:1},8,["model"])]),default:a(()=>[t(o,null,{default:a(()=>[c(f(e(l)("page.banlog.charts.options.more")),1)]),_:1})]),_:1})]),default:a(()=>[t(e(C),{class:"chart",option:h.value,loading:e(R),autoresize:"",loadingOptions:y.value,theme:e(_).isDark?"dark":"light","init-options":{renderer:"svg"}},null,8,["option","loading","loadingOptions","theme"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),Va=X(va,[["__scopeId","data-v-7b0b367a"]]);export{Va as default};
